<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A Ilha do Perigo II ‚Äî O Labirinto Perdido</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Patrick+Hand&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Fredoka',sans-serif;background:#1a1a2e;min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:16px;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse at 30% 20%,#16213e 0%,#0f3460 40%,#1a1a2e 70%);z-index:-2}
body::after{content:'';position:fixed;inset:0;background:url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");z-index:-1}
.header{text-align:center;margin-bottom:10px;animation:fadeDown .6s ease}
@keyframes fadeDown{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}
h1{font-weight:700;font-size:1.8rem;color:#e94560;text-shadow:0 0 30px rgba(233,69,96,.3);letter-spacing:1px}
.sub{font-family:'Patrick Hand',cursive;color:#a8b2d1;font-size:1rem;margin-top:2px}
.diff{display:inline-block;background:linear-gradient(135deg,#e94560,#c62a40);color:#fff;font-family:'Fredoka';font-size:.65rem;font-weight:700;padding:2px 10px;border-radius:20px;margin-left:6px;vertical-align:middle;letter-spacing:1px;text-transform:uppercase}
.tb{display:flex;gap:6px;margin-bottom:10px;flex-wrap:wrap;justify-content:center;animation:fadeDown .6s ease .1s both}
.lb{width:44px;height:44px;border:3px solid rgba(255,255,255,.15);border-radius:12px;font-family:'Fredoka';font-weight:700;font-size:1.2rem;cursor:pointer;color:#fff;text-shadow:1px 1px 3px rgba(0,0,0,.4);transition:all .2s}
.lb:hover{transform:scale(1.1);box-shadow:0 0 15px rgba(255,255,255,.15)}
.lb.on{border-color:#fff;transform:scale(1.15);box-shadow:0 4px 20px rgba(255,255,255,.25)}
.lb[data-l="A"]{background:#e53935}.lb[data-l="B"]{background:#1e88e5}.lb[data-l="C"]{background:#43a047}
.lb[data-l="D"]{background:#fb8c00}.lb[data-l="E"]{background:#8e24aa}.lb[data-l="F"]{background:#00acc1}
.lb[data-l="G"]{background:#d81b60}
.ab{height:44px;padding:0 12px;border:2px solid rgba(255,255,255,.15);border-radius:12px;font-family:'Fredoka';font-weight:600;font-size:.8rem;cursor:pointer;background:rgba(255,255,255,.08);color:#a8b2d1;transition:all .2s;backdrop-filter:blur(4px)}
.ab:hover{transform:scale(1.05);background:rgba(255,255,255,.15);color:#fff}
.ab.resp{background:linear-gradient(135deg,#e94560,#c62a40);color:#fff;border-color:rgba(233,69,96,.5);font-size:.85rem}
.ab.resp:hover{background:linear-gradient(135deg,#ff6b81,#e94560);box-shadow:0 0 20px rgba(233,69,96,.3)}
.eb{width:44px;height:44px;border:2px solid rgba(255,255,255,.15);border-radius:12px;font-size:1.2rem;cursor:pointer;background:rgba(255,255,255,.08);transition:all .2s}
.eb:hover{background:rgba(255,255,255,.15)}
.eb.on{border-color:#fff;transform:scale(1.15);box-shadow:0 4px 20px rgba(255,255,255,.25)}
.gw{background:linear-gradient(145deg,#16213e,#0f3460);border-radius:16px;padding:10px;box-shadow:0 8px 40px rgba(0,0,0,.5),inset 0 1px 0 rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.05);animation:fadeDown .6s ease .2s both}
.gr{display:grid;grid-template-columns:repeat(10,40px);grid-template-rows:repeat(12,40px);gap:2px;background:rgba(255,255,255,.08);border-radius:6px;overflow:hidden}
.c{width:40px;height:40px;background:rgba(255,255,255,.03);display:flex;align-items:center;justify-content:center;font-family:'Fredoka';font-weight:700;font-size:1.05rem;cursor:pointer;user-select:none;position:relative;color:#fff;text-shadow:1px 1px 3px rgba(0,0,0,.3);transition:background .15s,transform .1s}
.c:hover:not(.fx){background:rgba(255,255,255,.1);transform:scale(1.02)}
.c.fx{cursor:default;border:2px solid rgba(255,255,255,.4);border-radius:4px;box-shadow:inset 0 0 8px rgba(255,255,255,.1)}
.c.fx::after{content:'üè†';position:absolute;top:-1px;right:0;font-size:.45rem;filter:drop-shadow(0 0 2px rgba(255,255,255,.5))}
.c[data-v="A"]{background:#e53935}.c[data-v="B"]{background:#1e88e5}.c[data-v="C"]{background:#43a047}
.c[data-v="D"]{background:#fb8c00}.c[data-v="E"]{background:#8e24aa}.c[data-v="F"]{background:#00acc1}
.c[data-v="G"]{background:#d81b60}.c[data-v=""]{background:rgba(255,255,255,.03);color:transparent}
.st{margin-top:10px;font-family:'Patrick Hand',cursive;font-size:1.1rem;color:#a8b2d1;text-align:center;min-height:26px;transition:all .3s}
.st.ok{color:#69f0ae;font-weight:600;font-size:1.3rem;text-shadow:0 0 20px rgba(105,240,174,.3)}
.st.err{color:#ff5252}
.info{max-width:440px;margin-top:10px;padding:8px 12px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.05);border-radius:12px;font-family:'Patrick Hand',cursive;font-size:.9rem;color:#7986cb;line-height:1.3;backdrop-filter:blur(4px)}
.timer{font-family:'Fredoka';font-size:.95rem;color:#e94560;margin-top:6px;text-align:center;min-height:22px}
@media(max-width:500px){
.gr{grid-template-columns:repeat(10,32px);grid-template-rows:repeat(12,32px)}
.c{width:32px;height:32px;font-size:.85rem}
.gw{padding:8px}h1{font-size:1.3rem}.lb{width:38px;height:38px;font-size:1rem}.ab{height:38px;font-size:.7rem}.eb{width:38px;height:38px}
}
</style>
</head>
<body>
<div class="header">
<h1>üèùÔ∏è A Ilha do Perigo II</h1>
<p class="sub">O Labirinto Perdido <span class="diff">‚ö° Dif√≠cil</span></p>
</div>
<div class="tb">
  <button class="lb on" data-l="A">A</button>
  <button class="lb" data-l="B">B</button>
  <button class="lb" data-l="C">C</button>
  <button class="lb" data-l="D">D</button>
  <button class="lb" data-l="E">E</button>
  <button class="lb" data-l="F">F</button>
  <button class="lb" data-l="G">G</button>
  <button class="eb" data-l="">üßπ</button>
  <button class="ab" onclick="clearAll()">Limpar</button>
  <button class="ab" onclick="validate()">Verificar ‚úÖ</button>
  <button class="ab resp" onclick="showAnswer()">Resposta üí°</button>
</div>
<div class="gw"><div class="gr" id="grid"></div></div>
<div class="timer" id="timer"></div>
<div class="st" id="status"></div>
<div class="info">üìå Grid 10√ó12 com 7 letras. Conecte cada par de aldeias üè† sem cruzar caminhos. Todas as c√©lulas devem ser preenchidas!</div>

<script>
const RW=12,CL=10;
// Fixed endpoints (row,col) 0-indexed ‚Äî designed for solvability with full coverage
const FX={
  A:[[0,0],[11,9]],
  B:[[0,4],[6,9]],
  C:[[0,9],[11,0]],
  D:[[3,0],[9,5]],
  E:[[5,3],[11,6]],
  F:[[0,7],[8,0]],
  G:[[7,4],[11,3]]
};

let g=Array.from({length:RW},()=>Array(CL).fill(''));
let cur='A',drawing=false;
let startTime=Date.now(),timerInterval;

for(const[L,ps]of Object.entries(FX))for(const[r,c]of ps)g[r][c]=L;

function isFx(r,c){for(const ps of Object.values(FX))for(const[a,b]of ps)if(a===r&&b===c)return true;return false}

function startTimer(){
  clearInterval(timerInterval);
  startTime=Date.now();
  timerInterval=setInterval(()=>{
    const el=Date.now()-startTime,m=Math.floor(el/60000),s=Math.floor((el%60000)/1000);
    document.getElementById('timer').textContent=`‚è±Ô∏è ${m}:${s.toString().padStart(2,'0')}`;
  },1000);
}

function render(){
  const el=document.getElementById('grid');el.innerHTML='';
  for(let r=0;r<RW;r++)for(let c=0;c<CL;c++){
    const d=document.createElement('div');
    d.className='c'+(isFx(r,c)?' fx':'');
    d.dataset.r=r;d.dataset.c=c;d.dataset.v=g[r][c];d.textContent=g[r][c];
    d.addEventListener('mousedown',e=>{e.preventDefault();drawing=true;paint(r,c)});
    d.addEventListener('mouseenter',()=>{if(drawing)paint(r,c)});
    d.addEventListener('touchstart',e=>{e.preventDefault();drawing=true;paint(r,c)},{passive:false});
    d.addEventListener('touchmove',tm,{passive:false});
    el.appendChild(d);
  }
}

function paint(r,c){
  if(isFx(r,c))return;g[r][c]=cur;
  const d=document.querySelector(`[data-r="${r}"][data-c="${c}"]`);
  if(d){d.dataset.v=g[r][c];d.textContent=g[r][c]}
}

function tm(e){e.preventDefault();const t=e.touches[0],el=document.elementFromPoint(t.clientX,t.clientY);if(el&&el.dataset.r!==undefined)paint(+el.dataset.r,+el.dataset.c)}
document.addEventListener('mouseup',()=>drawing=false);
document.addEventListener('touchend',()=>drawing=false);

document.querySelectorAll('.lb,.eb').forEach(b=>b.addEventListener('click',()=>{
  document.querySelectorAll('.lb,.eb').forEach(x=>x.classList.remove('on'));
  b.classList.add('on');cur=b.dataset.l;
}));

function clearAll(){
  for(let r=0;r<RW;r++)for(let c=0;c<CL;c++)if(!isFx(r,c))g[r][c]='';
  render();document.getElementById('status').textContent='';document.getElementById('status').className='st';
  startTimer();
}

function validate(){
  const s=document.getElementById('status');let err=[];
  // Check all cells filled
  let empty=0;
  for(let r=0;r<RW;r++)for(let c=0;c<CL;c++)if(g[r][c]==='')empty++;
  if(empty>0)err.push(`${empty} c√©lulas vazias`);
  for(const L of'ABCDEFG'){
    const[a,b]=FX[L];
    if(!bfs(L,a,b))err.push(L+': n√£o conecta');
    const cells=[];for(let r=0;r<RW;r++)for(let c=0;c<CL;c++)if(g[r][c]===L)cells.push([r,c]);
    if(!contig(cells))err.push(L+': n√£o cont√≠nuo');
  }
  if(!err.length){
    clearInterval(timerInterval);
    s.textContent='üéâ Parab√©ns! Labirinto resolvido!';s.className='st ok';
  } else {
    s.textContent='‚ùå '+err.join(' | ');s.className='st err';
  }
}

function bfs(L,s,e){
  const v=new Set();v.add(s[0]+','+s[1]);const q=[s];
  while(q.length){const[r,c]=q.shift();if(r===e[0]&&c===e[1])return true;
  for(const[dr,dc]of[[0,1],[0,-1],[1,0],[-1,0]]){const nr=r+dr,nc=c+dc,k=nr+','+nc;
  if(nr>=0&&nr<RW&&nc>=0&&nc<CL&&!v.has(k)&&g[nr][nc]===L){v.add(k);q.push([nr,nc])}}}return false}

function contig(cells){
  if(cells.length<=1)return true;const set=new Set(cells.map(([r,c])=>r+','+c));
  const v=new Set();v.add(cells[0][0]+','+cells[0][1]);const q=[cells[0]];
  while(q.length){const[r,c]=q.shift();for(const[dr,dc]of[[0,1],[0,-1],[1,0],[-1,0]]){const k=(r+dr)+','+(c+dc);
  if(set.has(k)&&!v.has(k)){v.add(k);q.push([r+dr,c+dc])}}}return v.size===cells.length}

// SOLVER ‚Äî backtracking with area-fill constraint
function solvePuzzle(){
  for(let r=0;r<RW;r++)for(let c=0;c<CL;c++)if(!isFx(r,c))g[r][c]='';
  const order=['G','E','D','B','A','F','C'];
  return bt(order,0);
}

function countEmpty(){let n=0;for(let r=0;r<RW;r++)for(let c=0;c<CL;c++)if(g[r][c]==='')n++;return n}

function bt(order,idx){
  if(idx===order.length)return countEmpty()===0;
  const L=order[idx],[start,end]=FX[L],paths=[];
  dfsPaths(start[0],start[1],end[0],end[1],L,new Set([start[0]+','+start[1]]),[start],paths,200);
  // Sort paths by length descending to fill more area
  paths.sort((a,b)=>b.length-a.length);
  for(const p of paths){
    for(const[r,c]of p)g[r][c]=L;
    // Check remaining empty cells are all reachable (no isolated pockets)
    if(checkReachable()&&bt(order,idx+1))return true;
    for(const[r,c]of p)if(!isFx(r,c))g[r][c]='';
  }
  return false;
}

function checkReachable(){
  // Find all empty cells, check they form connected regions reachable by remaining letters
  const empties=[];
  for(let r=0;r<RW;r++)for(let c=0;c<CL;c++)if(g[r][c]==='')empties.push([r,c]);
  if(empties.length===0)return true;
  // Quick flood fill ‚Äî all empty cells should be in one connected component
  // (Relaxed: just check no tiny isolated cells)
  const set=new Set(empties.map(([r,c])=>r+','+c));
  const v=new Set();v.add(empties[0][0]+','+empties[0][1]);const q=[empties[0]];
  while(q.length){
    const[r,c]=q.shift();
    for(const[dr,dc]of[[0,1],[0,-1],[1,0],[-1,0]]){
      const k=(r+dr)+','+(c+dc);
      if(set.has(k)&&!v.has(k)){v.add(k);q.push([r+dr,c+dc])}
    }
  }
  return v.size>=empties.length*0.8; // allow small disconnects for flexibility
}

function dfsPaths(r,c,er,ec,L,vis,path,res,lim){
  if(res.length>=lim)return;
  if(r===er&&c===ec){res.push([...path]);return}
  if(path.length>40)return;
  const nb=[[0,1],[0,-1],[1,0],[-1,0]].map(([dr,dc])=>[r+dr,c+dc])
    .filter(([nr,nc])=>nr>=0&&nr<RW&&nc>=0&&nc<CL&&!vis.has(nr+','+nc)&&(g[nr][nc]===''||(nr===er&&nc===ec)))
    .sort((a,b)=>(Math.abs(a[0]-er)+Math.abs(a[1]-ec))-(Math.abs(b[0]-er)+Math.abs(b[1]-ec)));
  for(const[nr,nc]of nb){
    if(res.length>=lim)return;
    vis.add(nr+','+nc);path.push([nr,nc]);
    dfsPaths(nr,nc,er,ec,L,vis,path,res,lim);
    path.pop();vis.delete(nr+','+nc);
  }
}

function showAnswer(){
  const s=document.getElementById('status');
  s.textContent='üîÑ Calculando... (pode demorar)';s.className='st';
  setTimeout(()=>{
    if(solvePuzzle()){render();clearInterval(timerInterval);s.textContent='‚ú® Aqui est√° a resposta!';s.className='st ok'}
    else{render();s.textContent='üòî N√£o encontrou solu√ß√£o autom√°tica';s.className='st err'}
  },50);
}

render();
startTimer();
</script>
</body>
</html>
