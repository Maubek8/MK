<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A Ilha do Perigo</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Patrick+Hand&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Fredoka',sans-serif;background:#f4e8c1;min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:20px}
h1{font-weight:700;font-size:2rem;color:#5d4037;margin-bottom:4px}
.sub{font-family:'Patrick Hand',cursive;color:#8d6e63;font-size:1.1rem;margin-bottom:12px}
.tb{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap;justify-content:center}
.lb{width:48px;height:48px;border:3px solid #ccc;border-radius:12px;font-family:'Fredoka';font-weight:700;font-size:1.3rem;cursor:pointer;color:#fff;text-shadow:1px 1px 2px rgba(0,0,0,.3);transition:.2s}
.lb:hover{transform:scale(1.1)}.lb.on{border-color:#333;transform:scale(1.15);box-shadow:0 4px 12px rgba(0,0,0,.3)}
.lb[data-l="A"]{background:#e53935}.lb[data-l="B"]{background:#1e88e5}.lb[data-l="C"]{background:#43a047}.lb[data-l="D"]{background:#fb8c00}.lb[data-l="E"]{background:#8e24aa}
.ab{height:48px;padding:0 14px;border:3px solid #ccc;border-radius:12px;font-family:'Fredoka';font-weight:600;font-size:.85rem;cursor:pointer;background:#fff;color:#555;transition:.2s}
.ab:hover{transform:scale(1.05);background:#f5f5f5}
.ab.resp{background:linear-gradient(135deg,#ff6f00,#e65100);color:#fff;border-color:#bf360c;font-size:.95rem}
.ab.resp:hover{background:linear-gradient(135deg,#ff8f00,#ef6c00)}
.eb{width:48px;height:48px;border:3px solid #ccc;border-radius:12px;font-size:1.3rem;cursor:pointer;background:#fff;transition:.2s}
.eb.on{border-color:#333;transform:scale(1.15);box-shadow:0 4px 12px rgba(0,0,0,.3)}
.gw{background:linear-gradient(135deg,#5ba3c9,#2a7a9f);border-radius:18px;padding:14px;box-shadow:0 8px 25px rgba(0,0,0,.2)}
.gr{display:grid;grid-template-columns:repeat(8,46px);grid-template-rows:repeat(9,46px);gap:2px;background:#90a4ae;border-radius:6px;overflow:hidden}
.c{width:46px;height:46px;background:#fff;display:flex;align-items:center;justify-content:center;font-family:'Fredoka';font-weight:700;font-size:1.2rem;cursor:pointer;user-select:none;position:relative;color:#fff;text-shadow:1px 1px 2px rgba(0,0,0,.2);transition:background .1s}
.c:hover:not(.fx){background:#eee}.c.fx{cursor:default;border:3px solid rgba(0,0,0,.3)}
.c.fx::after{content:'üè†';position:absolute;top:0;right:1px;font-size:.5rem}
.c[data-v="A"]{background:#e53935}.c[data-v="B"]{background:#1e88e5}.c[data-v="C"]{background:#43a047}.c[data-v="D"]{background:#fb8c00}.c[data-v="E"]{background:#8e24aa}.c[data-v=""]{background:#fff;color:transparent}
.st{margin-top:12px;font-family:'Patrick Hand',cursive;font-size:1.1rem;color:#5d4037;text-align:center;min-height:28px}
.st.ok{color:#2e7d32;font-weight:600;font-size:1.3rem}
.info{max-width:420px;margin-top:12px;padding:10px 14px;background:rgba(255,255,255,.7);border-radius:12px;font-family:'Patrick Hand',cursive;font-size:.95rem;color:#6d4c41;line-height:1.3}
@media(max-width:500px){.gr{grid-template-columns:repeat(8,38px);grid-template-rows:repeat(9,38px)}.c{width:38px;height:38px;font-size:1rem}.gw{padding:10px}h1{font-size:1.5rem}}
</style>
</head>
<body>
<h1>üèùÔ∏è A Ilha do Perigo</h1>
<p class="sub">Preencha os caminhos com as letras ‚Äî sem cruzar!</p>
<div class="tb">
  <button class="lb on" data-l="A">A</button>
  <button class="lb" data-l="B">B</button>
  <button class="lb" data-l="C">C</button>
  <button class="lb" data-l="D">D</button>
  <button class="lb" data-l="E">E</button>
  <button class="eb" data-l="">üßπ</button>
  <button class="ab" onclick="clearAll()">Limpar</button>
  <button class="ab" onclick="validate()">Verificar ‚úÖ</button>
  <button class="ab resp" onclick="showAnswer()">Resposta üí°</button>
</div>
<div class="gw"><div class="gr" id="grid"></div></div>
<div class="st" id="status"></div>
<div class="info">üìå Selecione uma letra e clique/arraste nas c√©lulas. Cada letra conecta suas duas aldeias üè†. Caminhos n√£o podem se cruzar!</div>

<script>
const RW=9,CL=8;
// 0-indexed: D(1,6)‚Üí(8,2), B(1,7)‚Üí(7,6), E(3,3)‚Üí(3,7), C(4,5)‚Üí(9,8), A(6,1)‚Üí(5,8)
const FX={D:[[0,5],[7,1]],B:[[0,6],[6,5]],E:[[2,2],[2,6]],C:[[3,4],[8,7]],A:[[5,0],[4,7]]};
let g=Array.from({length:RW},()=>Array(CL).fill(''));
let cur='A',drawing=false;

for(const[L,ps]of Object.entries(FX))for(const[r,c]of ps)g[r][c]=L;

function isFx(r,c){for(const ps of Object.values(FX))for(const[a,b]of ps)if(a===r&&b===c)return true;return false}

function render(){
  const el=document.getElementById('grid');el.innerHTML='';
  for(let r=0;r<RW;r++)for(let c=0;c<CL;c++){
    const d=document.createElement('div');
    d.className='c'+(isFx(r,c)?' fx':'');
    d.dataset.r=r;d.dataset.c=c;d.dataset.v=g[r][c];d.textContent=g[r][c];
    d.addEventListener('mousedown',e=>{e.preventDefault();drawing=true;paint(r,c)});
    d.addEventListener('mouseenter',()=>{if(drawing)paint(r,c)});
    d.addEventListener('touchstart',e=>{e.preventDefault();drawing=true;paint(r,c)},{passive:false});
    d.addEventListener('touchmove',tm,{passive:false});
    el.appendChild(d);
  }
}

function paint(r,c){
  if(isFx(r,c))return;g[r][c]=cur;
  const d=document.querySelector(`[data-r="${r}"][data-c="${c}"]`);
  if(d){d.dataset.v=g[r][c];d.textContent=g[r][c]}
}

function tm(e){e.preventDefault();const t=e.touches[0],el=document.elementFromPoint(t.clientX,t.clientY);if(el&&el.dataset.r!==undefined)paint(+el.dataset.r,+el.dataset.c)}
document.addEventListener('mouseup',()=>drawing=false);
document.addEventListener('touchend',()=>drawing=false);

document.querySelectorAll('.lb,.eb').forEach(b=>b.addEventListener('click',()=>{
  document.querySelectorAll('.lb,.eb').forEach(x=>x.classList.remove('on'));
  b.classList.add('on');cur=b.dataset.l;
}));

function clearAll(){
  for(let r=0;r<RW;r++)for(let c=0;c<CL;c++)if(!isFx(r,c))g[r][c]='';
  render();const s=document.getElementById('status');s.textContent='';s.className='st';
}

function validate(){
  const s=document.getElementById('status');let err=[];
  for(const L of'ABCDE'){
    const[a,b]=FX[L];if(!bfs(L,a,b))err.push(L+': n√£o conecta');
    const cells=[];for(let r=0;r<RW;r++)for(let c=0;c<CL;c++)if(g[r][c]===L)cells.push([r,c]);
    if(!contig(cells))err.push(L+': n√£o cont√≠nuo');
  }
  if(!err.length){s.textContent='üéâ Parab√©ns! Tudo correto!';s.className='st ok'}
  else{s.textContent='‚ùå '+err.join(' | ');s.className='st'}
}

function bfs(L,s,e){
  const v=new Set();v.add(s[0]+','+s[1]);const q=[s];
  while(q.length){const[r,c]=q.shift();if(r===e[0]&&c===e[1])return true;
  for(const[dr,dc]of[[0,1],[0,-1],[1,0],[-1,0]]){const nr=r+dr,nc=c+dc,k=nr+','+nc;
  if(nr>=0&&nr<RW&&nc>=0&&nc<CL&&!v.has(k)&&g[nr][nc]===L){v.add(k);q.push([nr,nc])}}}return false}

function contig(cells){
  if(cells.length<=1)return true;const set=new Set(cells.map(([r,c])=>r+','+c));
  const v=new Set();v.add(cells[0][0]+','+cells[0][1]);const q=[cells[0]];
  while(q.length){const[r,c]=q.shift();for(const[dr,dc]of[[0,1],[0,-1],[1,0],[-1,0]]){const k=(r+dr)+','+(c+dc);
  if(set.has(k)&&!v.has(k)){v.add(k);q.push([r+dr,c+dc])}}}return v.size===cells.length}

// SOLVER - backtracking
function solvePuzzle(){
  for(let r=0;r<RW;r++)for(let c=0;c<CL;c++)if(!isFx(r,c))g[r][c]='';
  const order=['E','D','A','C','B'];
  return bt(order,0);
}

function bt(order,idx){
  if(idx===order.length)return true;
  const L=order[idx],[start,end]=FX[L],paths=[];
  dfsPaths(start[0],start[1],end[0],end[1],L,new Set([start[0]+','+start[1]]),[start],paths,800);
  for(const p of paths){
    for(const[r,c]of p)g[r][c]=L;
    if(bt(order,idx+1))return true;
    for(const[r,c]of p)if(!isFx(r,c))g[r][c]='';
  }
  return false;
}

function dfsPaths(r,c,er,ec,L,vis,path,res,lim){
  if(res.length>=lim)return;
  if(r===er&&c===ec){res.push([...path]);return}
  if(path.length>20)return;
  const nb=[[0,1],[0,-1],[1,0],[-1,0]].map(([dr,dc])=>[r+dr,c+dc])
    .filter(([nr,nc])=>nr>=0&&nr<RW&&nc>=0&&nc<CL&&!vis.has(nr+','+nc)&&(g[nr][nc]===''||(nr===er&&nc===ec)))
    .sort((a,b)=>(Math.abs(a[0]-er)+Math.abs(a[1]-ec))-(Math.abs(b[0]-er)+Math.abs(b[1]-ec)));
  for(const[nr,nc]of nb){
    if(res.length>=lim)return;
    vis.add(nr+','+nc);path.push([nr,nc]);
    dfsPaths(nr,nc,er,ec,L,vis,path,res,lim);
    path.pop();vis.delete(nr+','+nc);
  }
}

function showAnswer(){
  const s=document.getElementById('status');
  s.textContent='üîÑ Calculando...';s.className='st';
  setTimeout(()=>{
    if(solvePuzzle()){render();s.textContent='‚ú® Aqui est√° a resposta!';s.className='st ok'}
    else{render();s.textContent='üòî N√£o encontrou solu√ß√£o';s.className='st'}
  },50);
}

render();
</script>
</body>
</html>
